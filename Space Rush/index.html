<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Neon Space Dodger — Single File</title>
<style>
  :root{
    --bg:#05060a;
    --panel:#0b0f1a;
    --accent:#7cf7ff;
    --accent2:#9b7cff;
    --danger:#ff6b6b;
    --glass: rgba(255,255,255,0.04);
    --muted: rgba(255,255,255,0.25);
    --glass-2: rgba(255,255,255,0.02);
    --shadow: 0 6px 20px rgba(2,6,23,0.6);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{
    height:100%;
    margin:0;
    background: radial-gradient(1200px 800px at 10% 10%, #061026 0%, transparent 12%),
                radial-gradient(1200px 800px at 90% 90%, #0d0618 0%, transparent 12%),
                var(--bg);
    color:#eaf6ff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  .wrapper{
    width:100%;
    max-width:980px;
    margin:28px auto;
    padding:20px;
    display:grid;
    grid-template-columns: 1fr 320px;
    gap:18px;
    align-items:start;
  }

  header{
    grid-column: 1/-1;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    margin-bottom:6px;
  }
  h1{
    margin:0;
    font-size:20px;
    letter-spacing:0.4px;
    color:var(--accent);
  }
  .sub{
    color:var(--muted);
    font-size:13px;
  }

  .game-panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    border-radius:12px;
    padding:12px;
    box-shadow:var(--shadow);
    display:flex;
    flex-direction:column;
    gap:12px;
    min-height:520px;
  }

  canvas{
    width:100%;
    height:600px;
    display:block;
    border-radius:8px;
    background:
      linear-gradient(0deg, rgba(255,255,255,0.01), transparent),
      radial-gradient(circle at 20% 10%, rgba(124,247,255,0.03), transparent 6%),
      rgba(0,0,0,0.15);
    box-shadow: inset 0 -8px 30px rgba(0,0,0,0.6);
    touch-action:none;
  }

  .controls{
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:space-between;
  }
  .buttons{
    display:flex;
    gap:8px;
    align-items:center;
  }
  button{
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.06);
    color:var(--accent);
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    letter-spacing:0.3px;
    box-shadow: 0 4px 10px rgba(2,6,23,0.5);
  }
  button.ghost{
    color:var(--muted);
    background:transparent;
    border:1px dashed rgba(255,255,255,0.04);
  }
  .stats{
    background:var(--panel);
    padding:12px;
    border-radius:10px;
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:stretch;
    box-shadow:var(--shadow);
  }
  .stat-row{
    display:flex;
    justify-content:space-between;
    font-size:14px;
    color:var(--muted);
  }
  .stat-row strong{
    color:var(--accent);
  }

  .sidebar{
    min-width:260px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .card{
    background: linear-gradient(180deg, var(--glass), var(--glass-2));
    padding:12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 8px 18px rgba(2,6,23,0.5);
  }
  .instructions{
    color:var(--muted);
    font-size:13px;
    line-height:1.4;
  }
  .footer{
    font-size:12px;
    color:var(--muted);
    display:flex;
    justify-content:space-between;
    gap:8px;
  }

  .msg{
    text-align:center;
    padding:8px;
    border-radius:8px;
    background:linear-gradient(90deg, rgba(124,124,255,0.03), rgba(124,247,255,0.02));
    color:var(--accent);
    font-weight:700;
    letter-spacing:0.8px;
  }

  @media (max-width:920px){
    .wrapper{ grid-template-columns: 1fr; padding:12px; }
    canvas{ height:480px; }
  }

  /* small HUD text on canvas via overlay */
  .overlay-hint{
    position:absolute;
    right:22px;
    top:84px;
    font-size:12px;
    color:var(--muted);
    background:rgba(0,0,0,0.25);
    padding:8px 10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.02);
  }

</style>
</head>
<body>
<div class="wrapper">
  <header>
    <div>
      <h1>Neon Space Dodger</h1>
      <div class="sub">Dodge asteroids • Collect power-ups • Survive longer</div>
    </div>
    <div class="sub">Controls: ← → or A D (or touch left/right)</div>
  </header>

  <main class="game-panel">
    <canvas id="gameCanvas" width="760" height="600" aria-label="Neon Space Dodger game"></canvas>

    <div class="controls">
      <div class="buttons">
        <button id="startBtn">Start</button>
        <button id="pauseBtn" class="ghost">Pause</button>
        <button id="restartBtn" class="ghost">Restart</button>
      </div>
      <div class="msg" id="stateMsg">Ready</div>
    </div>
  </main>

  <aside class="sidebar">
    <div class="card stats">
      <div class="stat-row"><span>Score</span><strong id="score">0</strong></div>
      <div class="stat-row"><span>High Score</span><strong id="hi">0</strong></div>
      <div class="stat-row"><span>Lives</span><strong id="lives">3</strong></div>
      <div class="stat-row"><span>Level</span><strong id="level">1</strong></div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px 0;color:var(--accent);font-size:15px;">How to play</h3>
      <div class="instructions">
        • Move left/right with the keyboard or by tapping left/right sides on mobile.<br>
        • Avoid asteroids (red/orange) — collisions cost a life.<br>
        • Collect cyan crystal power-ups to gain temporary shield or slow time.<br>
        • Survive and score more as speed ramps across levels.
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px 0;color:var(--accent);font-size:15px;">Tips & settings</h3>
      <div class="instructions">
        • Click <strong>Pause</strong> to freeze. Use <strong>Restart</strong> to reset progress.<br>
        • Game stores high score locally. Clear your site data to reset it.
      </div>
    </div>

    <div class="card footer">
      <div>Made for CodePen</div>
      <div style="color:var(--muted)">v1.0</div>
    </div>
  </aside>
</div>

<script>
/*
  Neon Space Dodger
  Single-file HTML/JS/CSS game suitable for CodePen.
  - Keyboard and touch controls
  - canvas rendering
  - simple collision, powerups, difficulty scaling
*/

(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d', { alpha: false });

  // UI elements
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const restartBtn = document.getElementById('restartBtn');
  const scoreEl = document.getElementById('score');
  const hiEl = document.getElementById('hi');
  const livesEl = document.getElementById('lives');
  const levelEl = document.getElementById('level');
  const stateMsg = document.getElementById('stateMsg');

  // game state
  let width = canvas.width;
  let height = canvas.height;
  let running = false;
  let paused = false;
  let lastTime = 0;
  let spawnTimer = 0;
  let powerupTimer = 0;
  let score = 0;
  let highScore = Number(localStorage.getItem('nsd_hi') || 0);
  let level = 1;
  let lives = 3;

  hiEl.textContent = highScore;

  // player
  const player = {
    x: width/2,
    y: height - 72,
    w: 36,
    h: 48,
    speed: 380, // px/s
    vx: 0,
    shield: 0 // time in seconds
  };

  // arrays
  const asteroids = [];
  const powerups = [];

  // settings (can be tweaked)
  const baseSpawnRate = 1.1; // lower -> more frequent
  const baseSpeed = 70;

  // inputs
  const keys = { left:false, right:false };

  // helpers
  function rand(min,max){ return Math.random()*(max-min)+min; }
  function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

  // resize handling for crisp canvas
  function adaptCanvas(){
    // maintain logical size but scale for devicePixelRatio
    const DPR = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    width = Math.floor(rect.width);
    height = Math.floor(rect.height);
    canvas.width = Math.floor(width * DPR);
    canvas.height = Math.floor(height * DPR);
    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
    // reposition player if needed
    player.y = height - 72;
  }
  adaptCanvas();
  window.addEventListener('resize', adaptCanvas);

  // entity factories
  function spawnAsteroid() {
    const size = rand(18, 48) + Math.min(level*3, 50);
    const x = rand(size/2, width - size/2);
    const speed = baseSpeed + rand(20,70) + level*18;
    asteroids.push({
      x, y: -size, r: size/2, vx: rand(-30,30), vy: speed, rot: rand(0,Math.PI*2), spin: rand(-2,2),
      color: `hsl(${rand(10,45)},85%,60%)`
    });
  }
  function spawnPowerup() {
    const kind = Math.random() < 0.6 ? 'shield' : 'slow';
    const size = 20;
    const x = rand(size/2, width - size/2);
    powerups.push({
      x, y: -size, r: size/2, vy: rand(40,90), kind,
      color: kind === 'shield' ? '#7cf7ff' : '#9b7cff'
    });
  }

  // collisions
  function circleHitRect(cx,cy,cr, rx,ry,rw,rh){
    // nearest point on rect to circle center
    const nx = clamp(cx, rx, rx+rw);
    const ny = clamp(cy, ry, ry+rh);
    const dx = cx - nx, dy = cy - ny;
    return (dx*dx+dy*dy) <= cr*cr;
  }

  // draw helpers
  function drawBackground(dt){
    // subtle moving stars
    ctx.fillStyle = '#03040a';
    ctx.fillRect(0,0,width,height);
    ctx.globalCompositeOperation = 'lighter';
    for(let i=0;i<6;i++){
      const alpha = 0.02 + 0.02*Math.sin((Date.now()/1000)+(i));
      ctx.fillStyle = `rgba(124,247,255,${alpha})`;
      const sx = (i*83 + (Date.now()/12)%width) % width;
      ctx.fillRect((sx + i*20)%width, (i*110 + (Date.now()/7)%height)%height, 2,2);
    }
    ctx.globalCompositeOperation = 'source-over';
  }

  function drawPlayer(p){
    ctx.save();
    ctx.translate(p.x, p.y);
    // glow
    ctx.beginPath();
    ctx.fillStyle = 'rgba(124,247,255,0.06)';
    ctx.ellipse(0,6,26,12,0,0,Math.PI*2);
    ctx.fill();

    // ship - neon triangle
    ctx.beginPath();
    ctx.moveTo(0, -p.h/2);
    ctx.lineTo(-p.w/2, p.h/2);
    ctx.lineTo(p.w/2, p.h/2);
    ctx.closePath();
    ctx.fillStyle = 'rgba(10,10,15,0.9)';
    ctx.fill();

    // outline neon
    ctx.strokeStyle = player.shield > 0 ? 'rgba(124,247,255,0.95)' : 'rgba(155,124,255,0.95)';
    ctx.lineWidth = 3;
    ctx.stroke();

    // cockpit
    ctx.beginPath();
    ctx.fillStyle = 'rgba(255,255,255,0.06)';
    ctx.ellipse(0, 0, 6, 8, 0,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  function drawAsteroid(a, dt){
    ctx.save();
    ctx.translate(a.x, a.y);
    ctx.rotate(a.rot);
    // rock body
    ctx.beginPath();
    const s = a.r;
    ctx.moveTo(-s*0.6, -s*0.2);
    for(let i=0;i<6;i++){
      const ang = (i/6)*Math.PI*2;
      const rx = Math.cos(ang)*(s * (0.6 + Math.random()*0.4));
      const ry = Math.sin(ang)*(s * (0.6 + Math.random()*0.4));
      ctx.lineTo(rx, ry);
    }
    ctx.closePath();
    // gradient
    const g = ctx.createRadialGradient(-s*0.2,-s*0.2,s*0.1,0,0,s);
    g.addColorStop(0, 'rgba(255,255,255,0.12)');
    g.addColorStop(1, a.color);
    ctx.fillStyle = g;
    ctx.fill();
    // rim
    ctx.strokeStyle = 'rgba(0,0,0,0.35)';
    ctx.lineWidth = 1;
    ctx.stroke();
    ctx.restore();
  }

  function drawPowerup(pu){
    ctx.save();
    ctx.translate(pu.x, pu.y);
    ctx.beginPath();
    ctx.fillStyle = pu.color;
    ctx.moveTo(0,-8);
    ctx.lineTo(6,0);
    ctx.lineTo(0,8);
    ctx.lineTo(-6,0);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,0.06)';
    ctx.lineWidth = 1;
    ctx.stroke();
    // glow
    ctx.beginPath();
    ctx.fillStyle = pu.kind === 'shield' ? 'rgba(124,247,255,0.06)' : 'rgba(155,124,255,0.05)';
    ctx.ellipse(0,0,12,6,0,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  // game loop
  function update(dt){
    if(!running || paused) return;

    // increase score over time
    score += dt * 12 * (1 + level*0.08);
    scoreEl.textContent = Math.floor(score);

    // difficulty scaling: increase level every 25 seconds of play roughly
    const nxtLevel = Math.floor(score / 250) + 1;
    if(nxtLevel !== level){
      level = nxtLevel;
      levelEl.textContent = level;
    }

    // spawn asteroids
    spawnTimer -= dt;
    const spawnInterval = Math.max(0.28, baseSpawnRate - level*0.04 - (Math.min(score/800,0.4)));
    if(spawnTimer <= 0){
      spawnAsteroid();
      spawnTimer = spawnInterval;
    }

    // spawn powerups occasionally
    powerupTimer -= dt;
    if(powerupTimer <= 0){
      if(Math.random() < 0.45) spawnPowerup();
      powerupTimer = rand(6, 12);
    }

    // update asteroids
    for(let i = asteroids.length-1; i>=0; i--){
      const a = asteroids[i];
      a.rot += a.spin * dt;
      a.x += a.vx * dt;
      a.y += a.vy * dt;

      // if off screen, remove
      if(a.y - a.r > height + 50 || a.x < -200 || a.x > width + 200){
        asteroids.splice(i,1);
        continue;
      }

      // collision with player
      if(circleHitRect(a.x, a.y, a.r, player.x - player.w/2, player.y - player.h/2, player.w, player.h)){
        if(player.shield > 0){
          // consume shield and destroy asteroid
          player.shield = 0;
          asteroids.splice(i,1);
          score += 18;
        } else {
          asteroids.splice(i,1);
          lives -= 1;
          livesEl.textContent = lives;
          // small screen shake or flash (just flash background)
          flash();
          if(lives <= 0){
            endGame();
            return;
          }
        }
      }
    }

    // update powerups
    for(let i = powerups.length-1; i>=0; i--){
      const p = powerups[i];
      p.y += p.vy * dt;
      if(p.y - p.r > height + 30){ powerups.splice(i,1); continue; }

      if(circleHitRect(p.x, p.y, p.r, player.x - player.w/2, player.y - player.h/2, player.w, player.h)){
        // apply effect
        if(p.kind === 'shield'){
          player.shield = 5.0; // 5 seconds
        } else if(p.kind === 'slow'){
          // slow everything for short time by reducing velocities
          asteroids.forEach(a => { a.vy *= 0.55; a.vx *= 0.6; });
          // set timed restore
          setTimeout(()=> {
            asteroids.forEach(a => { a.vy *= 1.7; a.vx *= 1.7; });
          }, 2200);
        }
        score += 25;
        powerups.splice(i,1);
      }
    }

    // player shield timer
    if(player.shield > 0){
      player.shield = Math.max(0, player.shield - dt);
    }

    // player movement
    let moveDir = 0;
    if(keys.left) moveDir -= 1;
    if(keys.right) moveDir += 1;
    player.vx = moveDir * player.speed;
    // friction smoothing
    player.x += player.vx * dt;
    // clamp within boundaries
    player.x = clamp(player.x, player.w/2 + 6, width - player.w/2 - 6);
  }

  // small flash indicator
  let flashTimer = 0;
  function flash(){
    flashTimer = 0.12;
  }

  function draw(dt){
    // background
    drawBackground(dt);

    // overlay grid lines faint
    ctx.save();
    ctx.globalAlpha = 0.02;
    for(let i=0;i<10;i++){
      ctx.fillRect(0, i*(height/10), width, 1);
    }
    ctx.restore();

    // draw asteroids and powerups sorted by y (depth)
    const combined = [...asteroids, ...powerups].sort((a,b)=> (a.y - b.y));
    combined.forEach(e=>{
      if(e.vy){
        if(e.kind) drawPowerup(e);
        else drawAsteroid(e);
      }
    });

    // draw player with shield glow if any
    if(player.shield > 0){
      // shield ring
      ctx.beginPath();
      ctx.ellipse(player.x, player.y + 2, player.w, player.h*0.7, 0, 0, Math.PI*2);
      ctx.fillStyle = `rgba(124,247,255,${0.06 + 0.03*Math.sin(Date.now()/120)})`;
      ctx.fill();
    }
    drawPlayer(player);

    // HUD on canvas
    ctx.save();
    ctx.font = '700 14px Inter, Arial';
    ctx.fillStyle = 'rgba(124,247,255,0.9)';
    ctx.fillText('Score: ' + Math.floor(score), 14, 20);
    ctx.fillStyle = 'rgba(155,124,255,0.8)';
    ctx.fillText('Level: ' + level, 14, 40);
    ctx.restore();

    // screen flash effect
    if(flashTimer > 0){
      ctx.fillStyle = `rgba(255,50,50,${0.06 * (flashTimer/0.12)})`;
      ctx.fillRect(0,0,width,height);
    }
  }

  function loop(ts){
    if(!lastTime) lastTime = ts;
    const dt = Math.min(0.05, (ts - lastTime)/1000);
    lastTime = ts;

    if(running && !paused){
      update(dt);
    }
    draw(dt);

    if(flashTimer > 0) flashTimer = Math.max(0, flashTimer - dt);

    requestAnimationFrame(loop);
  }

  // game controls
  function startGame(){
    running = true;
    paused = false;
    lastTime = 0;
    spawnTimer = 0.6;
    powerupTimer = 6;
    score = 0;
    level = 1;
    lives = 3;
    asteroids.length = 0;
    powerups.length = 0;
    player.x = width/2;
    player.shield = 0;
    scoreEl.textContent = 0;
    levelEl.textContent = 1;
    livesEl.textContent = 3;
    stateMsg.textContent = 'Playing';
    startBtn.disabled = true;
    pauseBtn.classList.remove('ghost');
    hiEl.textContent = highScore;
    if(!animationStarted){
      animationStarted = true;
      requestAnimationFrame(loop);
    }
  }

  function pauseGame(){
    if(!running) return;
    paused = !paused;
    stateMsg.textContent = paused ? 'Paused' : 'Playing';
    pauseBtn.textContent = paused ? 'Resume' : 'Pause';
    pauseBtn.classList.toggle('ghost', !paused);
  }

  function restartGame(){
    startBtn.disabled = false;
    paused = false;
    running = false;
    stateMsg.textContent = 'Ready';
    pauseBtn.textContent = 'Pause';
    pauseBtn.classList.add('ghost');
    asteroids.length = 0;
    powerups.length = 0;
    score = 0;
    level = 1;
    lives = 3;
    player.shield = 0;
    scoreEl.textContent = 0;
    levelEl.textContent = 1;
    livesEl.textContent = 3;
  }

  function endGame(){
    running = false;
    paused = false;
    stateMsg.textContent = 'Game Over';
    startBtn.disabled = false;
    pauseBtn.classList.add('ghost');
    // update high score
    const s = Math.floor(score);
    if(s > highScore){
      highScore = s;
      localStorage.setItem('nsd_hi', highScore);
      hiEl.textContent = highScore;
      stateMsg.textContent = 'NEW HIGH SCORE!';
    }
  }

  // keyboard handling
  window.addEventListener('keydown', (e) => {
    if(e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') keys.left = true;
    if(e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') keys.right = true;
    if(e.key === ' '){ e.preventDefault(); if(running) pauseGame(); else startGame(); }
    if(e.key === 'r' || e.key === 'R') restartGame();
  });
  window.addEventListener('keyup', (e) => {
    if(e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') keys.left = false;
    if(e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') keys.right = false;
  });

  // touch controls: tap left/right halves for movement; swipe for quick dodge
  let touchId = null;
  canvas.addEventListener('pointerdown', (ev) => {
    if(ev.pointerType === 'touch' || ev.pointerType === 'pen' || ev.pointerType === 'mouse'){
      const rect = canvas.getBoundingClientRect();
      const x = ev.clientX - rect.left;
      touchId = ev.pointerId;
      if(x < rect.width/2){ keys.left = true; keys.right = false; }
      else { keys.right = true; keys.left = false; }
      // start if not running
      if(!running) startGame();
    }
  });
  window.addEventListener('pointerup', (ev) => {
    if(ev.pointerId === touchId){
      keys.left = false; keys.right = false;
      touchId = null;
    }
  });
  window.addEventListener('pointercancel', () => { keys.left=false; keys.right=false; touchId=null; });

  // hook buttons
  startBtn.addEventListener('click', () => {
    startGame();
  });
  pauseBtn.addEventListener('click', () => {
    if(!running) return;
    pauseGame();
  });
  restartBtn.addEventListener('click', () => {
    restartGame();
  });

  // initial demo asteroids for visual interest when idle
  function idleSpawn(){
    if(!running){
      if(Math.random() < 0.4) spawnAsteroid();
      if(Math.random() < 0.05) spawnPowerup();
    }
    setTimeout(idleSpawn, 800 + Math.random()*1600);
  }
  idleSpawn();

  // start animation loop once to show idle screen
  let animationStarted = false;
  if(!animationStarted){
    animationStarted = true;
    requestAnimationFrame(loop);
  }

  // small polish: pause when page hidden
  document.addEventListener('visibilitychange', () => {
    if(document.hidden && running && !paused){
      paused = true;
      pauseBtn.textContent = 'Resume';
      stateMsg.textContent = 'Paused';
    }
  });

  // small mobile friendly: reduce motion if prefers-reduced-motion set
  const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
  if(mq.matches){
    player.speed = 260;
  }

  // expose for debugging (dev only)
  window._nsd = {
    spawnAsteroid, spawnPowerup, getState: ()=>({score,level,lives,asteroids,powerups})
  };

})();
</script>
